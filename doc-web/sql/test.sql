SET SERVEROUTPUT ON
DECLARE
    P_DOC_ID_ORIGEN         VARCHAR2(4000) := '77db8ad437fb4eb18f48df8d8454f40e';
    P_PIN_ID_NUEVO          VARCHAR2(4000) := 'a58f7515376b47599441df199a126155';
    P_DOC_ID_NUEVO          VARCHAR2(4000) := 'ac018de9e99748f8b30681eef86a3779';
    P_DEP_ID_DES            NUMBER         := 1493;
    P_DOC_CONTENT_FILE      VARCHAR2(4000) := 'e6b6883f3da449fb9957b279cb49ce8e';
    P_DOC_DOCX_DOCUMENTO    VARCHAR2(4000) := '8a11a7d1180e471bab1115b196fe5db4';
    P_ARRAY_UUID            T_ARRAY_UUID   := T_ARRAY_UUID('abc','def','d');
BEGIN
    PROC_COPIA_DOC_MULTIDESTINO(P_DOC_ID_ORIGEN,P_PIN_ID_NUEVO,P_DOC_ID_NUEVO,P_DEP_ID_DES,P_DOC_CONTENT_FILE,P_DOC_DOCX_DOCUMENTO,P_ARRAY_UUID);
END;
/
select * from usuario;
select * from usuario where usu_ID = 1069;
update documento set USU_ID_FIRMA = 141,cargo_id_firma = 752 where doc_id in ('6b2dce780dab40959504c5baeee29674','ac018de9e99748f8b30681eef86a3779');
--6b2dce780dab40959504c5baeee29674
--ac018de9e99748f8b30681eef86a3779
declare
    P_DOC_ID        DOCUMENTO.DOC_ID%TYPE := '6b2dce780dab40959504c5baeee29674';
    P_USU_ID_FIRMA  DOCUMENTO.USU_ID_FIRMA%TYPE := 141;
    P_DOC_RADICADO  DOCUMENTO.DOC_RADICADO%TYPE := '45';
    P_AUX           VARCHAR2(32767);
begin
    P_AUX := FN_PDF_RADIOGRAMA_MAIN(P_DOC_ID, P_USU_ID_FIRMA, P_DOC_RADICADO);
    DBMS_OUTPUT.PUT_LINE('P_AUX= '||P_AUX);
end;
/

select *
from documento
ORDER BY cuando desc;

SELECT * FROM PROCESO_INSTANCIA WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM PROCESO_INSTANCIA WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';

SELECT * FROM PROCESO_INSTANCIA_VAR WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM PROCESO_INSTANCIA_VAR WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';

SELECT * FROM H_PROCESO_INSTANCIA WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM H_PROCESO_INSTANCIA WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';

SELECT * FROM H_PROCESO_INSTANCIA_VAR WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM H_PROCESO_INSTANCIA_VAR WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708' ORDER BY HPIV_ID, PIV_ID;

SELECT * FROM INSTANCIA_BANDEJA WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM INSTANCIA_BANDEJA WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';

SELECT * FROM S_INSTANCIA_USUARIO WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM S_INSTANCIA_USUARIO WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';

SELECT * FROM DOCUMENTO WHERE PIN_ID = '93c8bcf25d34499eb0dd19082eca9d5a';
SELECT * FROM DOCUMENTO WHERE PIN_ID = 'a68f8979d722409fa730575fd70bb708';


SELECT * FROM DOCUMENTO_ADJUNTO WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_ADJUNTO WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b' ORDER BY CUANDO ASC;

SELECT * FROM DOCUMENTO_OBS WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_OBS WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b' ORDER BY CUANDO ASC;

SELECT * FROM DOCUMENTO_PDF WHERE DOCPDF_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_PDF WHERE DOCPDF_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM DOCUMENTO_USU_APRUEBA WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_USU_APRUEBA WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM DOCUMENTO_USU_ELABORA WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_USU_ELABORA WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM DOCUMENTO_USU_FIRMA WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_USU_FIRMA WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM DOCUMENTO_USU_VISTOS_BUENOS WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_USU_VISTOS_BUENOS WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM DOCUMENTO_DEPENDENCIA WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM DOCUMENTO_DEPENDENCIA WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

SELECT * FROM TMP_ARBOL_DEPEN WHERE DOC_ID = '6fdb3bed5cb748819074ed28a871a209';
SELECT * FROM TMP_ARBOL_DEPEN WHERE DOC_ID = '52715961221b41d8b5daf2b5cb72ef6b';

set SERVEROUTPUT ON
declare
    P_DOC_ID_ORIGINAL VARCHAR2(300) := '598dfef1313e4edaa99cfb8f41036a91';
    cursor c_borrado is
    select a.doc_id_original, a.doc_id_resultado doc_id, b.pin_id, b.doc_content_file, b.doc_docx_documento, b.doc_pdf
    from DEPENDENCIA_COPIA_MULTIDESTINO a,
         DOCUMENTO b
    where b.doc_id = a.doc_id_resultado
    and a.doc_id_original = P_DOC_ID_ORIGINAL;
    P_AUX_BORRAR    VARCHAR2(32767) := 'Se deben borrar los siguientes archivos: ';
begin
    for aux_c_borrado in c_borrado loop
        update DEPENDENCIA_COPIA_MULTIDESTINO set doc_id_resultado = null, fechahora_crea_doc_resultado = null where DOC_ID_ORIGINAL = P_DOC_ID_ORIGINAL and doc_id_resultado = aux_c_borrado.doc_id;
        P_AUX_BORRAR := P_AUX_BORRAR ||chr(10)|| aux_c_borrado.doc_content_file ||'-'||aux_c_borrado.doc_docx_documento||'-'||aux_c_borrado.doc_pdf;
        DELETE FROM PROCESO_INSTANCIA WHERE PIN_ID = aux_c_borrado.pin_id ;
        DELETE FROM PROCESO_INSTANCIA_VAR WHERE PIN_ID = aux_c_borrado.pin_id;
        DELETE FROM H_PROCESO_INSTANCIA WHERE PIN_ID = aux_c_borrado.pin_id;
        DELETE FROM H_PROCESO_INSTANCIA_VAR WHERE PIN_ID = aux_c_borrado.pin_id;
        DELETE FROM INSTANCIA_BANDEJA WHERE PIN_ID = aux_c_borrado.pin_id;
        DELETE FROM S_INSTANCIA_USUARIO WHERE PIN_ID = aux_c_borrado.pin_id;
        DELETE FROM DOCUMENTO WHERE PIN_ID = aux_c_borrado.pin_id;
        
        DELETE FROM DOCUMENTO_ADJUNTO WHERE DOC_ID = aux_c_borrado.doc_id;

        DELETE FROM DOCUMENTO_OBS WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_PDF WHERE DOCPDF_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_USU_APRUEBA WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_USU_ELABORA WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_USU_FIRMA WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_USU_VISTOS_BUENOS WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM DOCUMENTO_DEPENDENCIA WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE FROM TMP_ARBOL_DEPEN WHERE DOC_ID = aux_c_borrado.doc_id;
        DELETE DOCUMENTO_DEPENDENCIA WHERE DOC_ID = aux_c_borrado.doc_id;   
    end loop;
    DELETE DOCUMENTO_DEPENDENCIA WHERE DOC_ID = P_DOC_ID_ORIGINAL;
    
    DBMS_OUTPUT.PUT_LINE(P_AUX_BORRAR);
end;

